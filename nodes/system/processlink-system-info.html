<script type="text/javascript">
  RED.nodes.registerType("processlink-system-info", {
    category: "Process Link",
    color: "#f97316",
    defaults: {
      name: { value: "" },
      sendOnDeploy: { value: true },
    },
    inputs: 1,
    outputs: 1,
    icon: "processlink.png",
    paletteLabel: "system info",
    label: function () {
      return this.name || "system info";
    },
    labelStyle: function () {
      return this.name ? "node_label_italic" : "";
    },
    inputLabels: "trigger",
    outputLabels: "system info",
  });
</script>

<script type="text/html" data-template-name="processlink-system-info">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name" />
  </div>
  <div class="form-row">
    <label for="node-input-sendOnDeploy">&nbsp;</label>
    <input type="checkbox" id="node-input-sendOnDeploy" style="width: auto; margin-right: 10px;" checked>
    <span>Send system info on deploy</span>
  </div>
</script>

<script type="text/html" data-help-name="processlink-system-info">
  <p>Outputs system information for diagnostics and monitoring.</p>

  <h3>Triggers</h3>
  <ul>
    <li><strong>On deploy</strong> (if enabled) - Automatically sends when flow starts</li>
    <li><strong>On input</strong> - Any incoming message triggers a fresh reading</li>
  </ul>

  <h3>Configuration</h3>
  <dl class="message-properties">
    <dt>Send on deploy <span class="property-type">boolean</span></dt>
    <dd>When checked (default), outputs system info when the flow is deployed.</dd>
  </dl>

  <h3>Output</h3>
  <p><code>msg.payload</code> contains:</p>

  <table>
    <tr><td><strong>timestamp</strong></td><td>ISO 8601 UTC timestamp</td></tr>
    <tr><td><strong>localTime</strong></td><td>Device local time string</td></tr>
    <tr><td><strong>timezone</strong></td><td>Timezone name (e.g., "Australia/Sydney")</td></tr>
    <tr><td><strong>hostname</strong></td><td>Device hostname</td></tr>
    <tr><td><strong>platform</strong></td><td>"win32", "linux", or "darwin"</td></tr>
    <tr><td><strong>os</strong></td><td>OS name and version</td></tr>
    <tr><td><strong>arch</strong></td><td>CPU architecture</td></tr>
    <tr><td><strong>user</strong></td><td>User running Node-RED</td></tr>
    <tr><td><strong>workingDirectory</strong></td><td>Node-RED working directory</td></tr>
    <tr><td><strong>uptime</strong></td><td>System uptime (raw seconds, breakdown, formatted)</td></tr>
    <tr><td><strong>cpu</strong></td><td>Model, cores, architecture</td></tr>
    <tr><td><strong>memory</strong></td><td>Total, free, used (bytes + formatted), usedPercent</td></tr>
    <tr><td><strong>disk</strong></td><td>Total, free, used (bytes + formatted), usedPercent</td></tr>
    <tr><td><strong>network</strong></td><td>primaryIP, mac, interfaces</td></tr>
    <tr><td><strong>nodeRed</strong></td><td>version, uptime</td></tr>
    <tr><td><strong>nodejs</strong></td><td>version</td></tr>
    <tr><td><strong>processMemory</strong></td><td>rss, heapTotal, heapUsed</td></tr>
  </table>

  <h3>Uptime Structure</h3>
  <pre>{
  "raw": 432000,
  "breakdown": { "days": 5, "hours": 0, "minutes": 0, "seconds": 0 },
  "formatted": "5d 0h 0m 0s"
}</pre>

  <h3>Memory/Disk Structure</h3>
  <pre>{
  "total": { "bytes": 17179869184, "formatted": "16.00 GB" },
  "free": { "bytes": 8589934592, "formatted": "8.00 GB" },
  "used": { "bytes": 8589934592, "formatted": "8.00 GB" },
  "usedPercent": 50
}</pre>

  <h3>Notes</h3>
  <ul>
    <li><strong>disk</strong> may be unavailable on some systems due to permissions.</li>
    <li><strong>nodeRed.uptime</strong> tracks time since flow was deployed.</li>
    <li>Use <strong>usedPercent</strong> for easy threshold checks.</li>
  </ul>

  <h3>References</h3>
  <ul>
    <li><a href="https://portal.processlink.com.au" target="_blank">Process Link Portal</a></li>
    <li><a href="https://github.com/process-link/node-red-contrib-processlink" target="_blank">GitHub</a></li>
  </ul>
</script>
