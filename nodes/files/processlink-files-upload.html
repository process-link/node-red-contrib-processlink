<script type="text/javascript">
  RED.nodes.registerType("processlink-files-upload", {
    category: "Process Link",
    color: "#f97316",
    defaults: {
      name: { value: "" },
      server: { value: "", type: "processlink-config", required: true },
      filename: { value: "" },
      timestampPrefix: { value: false },
      timeout: { value: "30000" },
      apiUrl: { value: "https://files.processlink.com.au/api/upload" },
    },
    inputs: 1,
    outputs: 2,
    icon: "processlink.png",
    paletteLabel: "files upload",
    label: function () {
      return this.name || "files upload";
    },
    labelStyle: function () {
      return this.name ? "node_label_italic" : "";
    },
    inputLabels: "file buffer",
    outputLabels: ["success", "error"],
  });
</script>

<script type="text/html" data-template-name="processlink-files-upload">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name" />
  </div>
  <div class="form-row">
    <label for="node-input-server"><i class="fa fa-server"></i> Config</label>
    <input type="text" id="node-input-server" />
  </div>
  <div class="form-row">
    <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
    <input type="text" id="node-input-filename" placeholder="msg.filename (or specify default)" />
  </div>
  <div class="form-row">
    <label for="node-input-timestampPrefix">&nbsp;</label>
    <input type="checkbox" id="node-input-timestampPrefix" style="width: auto; margin-right: 10px;">
    <span>Prefix filename with timestamp (YYYY-MM-DD_HH-mm-ss_)</span>
  </div>
  <div class="form-row">
    <label for="node-input-timeout"><i class="fa fa-clock-o"></i> Timeout</label>
    <input type="text" id="node-input-timeout" placeholder="30000" />
    <span style="margin-left: 5px; color: #888">ms</span>
  </div>
  <div class="form-row" style="display: none">
    <label for="node-input-apiUrl"><i class="fa fa-link"></i> API URL</label>
    <input type="text" id="node-input-apiUrl" />
  </div>
</script>

<script type="text/html" data-help-name="processlink-files-upload">
  <p>Uploads files to the Process Link Files API.</p>

  <h3>Inputs</h3>
  <dl class="message-properties">
    <dt>payload <span class="property-type">buffer | string</span></dt>
    <dd>The file content to upload.</dd>
    <dt class="optional">filename <span class="property-type">string</span></dt>
    <dd>Filename for the upload. Can be set via <code>msg.filename</code> or in the node config. Defaults to "file.bin".</dd>
  </dl>

  <h3>Outputs</h3>
  <p>This node has two outputs:</p>
  <ol>
    <li><strong>Success</strong> - Upload completed successfully (HTTP 201)</li>
    <li><strong>Error</strong> - Upload failed (network error, API error, or timeout)</li>
  </ol>

  <h4>Success Output</h4>
  <dl class="message-properties">
    <dt>payload.ok <span class="property-type">boolean</span></dt>
    <dd><code>true</code></dd>
    <dt>payload.file_id <span class="property-type">string</span></dt>
    <dd>UUID of the uploaded file.</dd>
    <dt>file_id <span class="property-type">string</span></dt>
    <dd>Same as above (convenience property).</dd>
    <dt>statusCode <span class="property-type">number</span></dt>
    <dd>201</dd>
  </dl>

  <h4>Error Output</h4>
  <dl class="message-properties">
    <dt>payload.error <span class="property-type">string</span></dt>
    <dd>Error message from the API or network layer.</dd>
    <dt>statusCode <span class="property-type">number</span></dt>
    <dd>HTTP status code, or 0 for network/timeout errors.</dd>
  </dl>

  <h3>Configuration</h3>
  <dl class="message-properties">
    <dt>Filename <span class="property-type">string</span></dt>
    <dd>Default filename if <code>msg.filename</code> is not set.</dd>
    <dt>Prefix with timestamp <span class="property-type">boolean</span></dt>
    <dd>Adds <code>YYYY-MM-DD_HH-mm-ss_</code> prefix to filename.</dd>
    <dt>Timeout <span class="property-type">number</span></dt>
    <dd>Request timeout in ms. Default: 30000.</dd>
  </dl>

  <h3>Status Codes</h3>
  <ul>
    <li><strong>201</strong> - Success</li>
    <li><strong>400</strong> - Bad request</li>
    <li><strong>401</strong> - Invalid API key</li>
    <li><strong>403</strong> - API access not enabled</li>
    <li><strong>404</strong> - Site not found</li>
    <li><strong>429</strong> - Rate limit exceeded</li>
    <li><strong>507</strong> - Storage limit exceeded</li>
  </ul>

  <h3>References</h3>
  <ul>
    <li><a href="https://portal.processlink.com.au" target="_blank">Process Link Portal</a></li>
    <li><a href="https://github.com/process-link/node-red-contrib-processlink" target="_blank">GitHub</a></li>
  </ul>
</script>
