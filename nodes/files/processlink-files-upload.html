<script type="text/javascript">
  RED.nodes.registerType("processlink-files-upload", {
    category: "Process Link",
    color: "#f97316",
    defaults: {
      name: { value: "" },
      server: { value: "", type: "processlink-config", required: true },
      filename: { value: "" },
      timeout: { value: "30000" },
      apiUrl: { value: "https://files.processlink.com.au/api/upload" },
    },
    inputs: 1,
    outputs: 1,
    icon: "processlink.svg",
    paletteLabel: "files upload",
    label: function () {
      return this.name || "files upload";
    },
    labelStyle: function () {
      return this.name ? "node_label_italic" : "";
    },
    inputLabels: "file buffer",
    outputLabels: "response",
  });
</script>

<script type="text/html" data-template-name="processlink-files-upload">
  <div class="form-row">
    <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
    <input type="text" id="node-input-name" placeholder="Name" />
  </div>
  <div class="form-row">
    <label for="node-input-server"><i class="fa fa-server"></i> Config</label>
    <input type="text" id="node-input-server" />
  </div>
  <div class="form-row">
    <label for="node-input-filename"><i class="fa fa-file"></i> Filename</label>
    <input type="text" id="node-input-filename" placeholder="msg.filename (or specify default)" />
  </div>
  <div class="form-row">
    <label for="node-input-timeout"><i class="fa fa-clock-o"></i> Timeout</label>
    <input type="text" id="node-input-timeout" placeholder="30000" />
    <span style="margin-left: 5px; color: #888">ms</span>
  </div>
  <div class="form-row" style="display: none">
    <label for="node-input-apiUrl"><i class="fa fa-link"></i> API URL</label>
    <input type="text" id="node-input-apiUrl" />
  </div>
</script>

<script type="text/html" data-help-name="processlink-files-upload">
  <p>Uploads files to the Process Link Files API.</p>

  <h3>Inputs</h3>
  <dl class="message-properties">
    <dt>payload <span class="property-type">buffer | string</span></dt>
    <dd>The file content to upload.</dd>
    <dt class="optional">filename <span class="property-type">string</span></dt>
    <dd>The filename to use. Defaults to the configured filename or "file.bin".</dd>
  </dl>

  <h3>Outputs</h3>
  <dl class="message-properties">
    <dt>payload <span class="property-type">object</span></dt>
    <dd>The API response containing <code>ok</code>, <code>file_id</code>, and <code>created_at</code>.</dd>
    <dt>file_id <span class="property-type">string</span></dt>
    <dd>The UUID of the uploaded file (convenience property).</dd>
    <dt>statusCode <span class="property-type">number</span></dt>
    <dd>The HTTP status code (201 on success).</dd>
  </dl>

  <h3>Details</h3>
  <p>
    This node uploads files to your Process Link site. The file content should be passed in
    <code>msg.payload</code> as a Buffer (from a file-in node) or as a string.
  </p>
  <p>
    The filename can be set in <code>msg.filename</code> or configured in the node properties. If
    the filename contains a path, only the basename will be used.
  </p>

  <h3>Status Codes</h3>
  <ul>
    <li><strong>201</strong> - Upload successful</li>
    <li><strong>400</strong> - Bad request (missing file, invalid site ID)</li>
    <li><strong>401</strong> - Invalid API key</li>
    <li><strong>403</strong> - API access not enabled for this site</li>
    <li><strong>404</strong> - Site not found</li>
    <li><strong>429</strong> - Rate limit exceeded (max 30 uploads/minute)</li>
    <li><strong>507</strong> - Storage limit exceeded</li>
  </ul>

  <h3>Example Flow</h3>
  <pre>
[File In] → [Process Link Upload] → [Debug]

The File In node reads a file and outputs msg.payload (Buffer)
and msg.filename. Connect directly to this node to upload.</pre>

  <h3>References</h3>
  <ul>
    <li>
      <a href="https://files.processlink.com.au" target="_blank">Process Link Files</a> - Manage
      your files and API keys
    </li>
    <li>
      <a href="https://github.com/process-link/node-red-contrib-processlink" target="_blank"
        >GitHub</a
      >
      - Source code and issues
    </li>
  </ul>
</script>
